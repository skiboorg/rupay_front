"use strict";(self["webpackChunkrupay_front"]=self["webpackChunkrupay_front"]||[]).push([[7321],{27321:(e,a,l)=>{l.r(a),l.d(a,{default:()=>z});l(40702),l(84641),l(83269),l(84607),l(25231),l(69359),l(56408);var t=l(59835),u=l(60499),s=l(61957),n=l(99407),r=l(87270),o=l(23459),d=l(46190),i=l(91569),m=(l(98030),l(39981),l(17779));const p=(0,t._)("div",{class:"",style:{height:"20px"}},null,-1),c={key:0,class:""},v={class:"flex items-center justify-start q-mb-lg"},g=["src"],b={class:"absolute-bottom-right cursor-pointer",for:"take_img"},h=(0,t._)("p",null,"Фото *",-1),y={class:"row items-center justify-end"},f=(0,t._)("p",{class:"q-mb-none"},"Пол*",-1),w={class:"q-gutter-sm q-mb-lg"},_=(0,t._)("p",{class:"text-center text-weight-medium"},"Ожидайте верификацию",-1),U={key:0,class:"text-center text-weight-medium"},V=(0,t.Uk)("Если вы не смогли поделиться файлом верификации через соцсеть, то "),q=["href"],k=(0,t.Uk)(" его напрямую"),N={name:"CreatePersonAlt",setup(e){const a=(0,o.Q)(),l=(0,d.c)(),N=(0,u.iH)(null),W=320,x=200,P="image/jpeg",R=1;localStorage.getItem("verify_sent");let C=(0,u.iH)(!1),j=(0,u.iH)(!1),Q=(0,u.iH)(null);const I=(0,u.iH)({firstName:null,lastName:null,middleName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null,passport:null,user_photo:null}),L=((0,u.iH)({amount:"",address:"7R6mzr8YDu1eWiRjBRWyEufz8gL2V9zPmB",title:"Оплата верификации",message:"Оплата верификации",encrypted:!1,fee:0,raw:0}),(0,t.Fl)((()=>!I.value.firstName||!I.value.lastName||!I.value.birthday||!I.value.userPhoto||!I.value.passport))),Z=((0,t.Fl)((()=>l.balances)),(0,t.Fl)((()=>l.addresses[l.currentAddressIdx].publicKey)),(0,t.Fl)((()=>l.addresses[l.currentAddressIdx].address)));const F=async()=>{let e=N.value.files[0];I.value.user_photo=e;const a=URL.createObjectURL(e),l=new Image;l.src=a,l.onerror=function(){URL.revokeObjectURL(this.src),m.log("Cannot load image")},l.onload=function(){URL.revokeObjectURL(this.src);const[a,t]=S(l,W,x),u=document.createElement("canvas");u.width=a,u.height=t;const s=u.getContext("2d");s.drawImage(l,0,0,a,t),u.toBlob((a=>{m.log("Original file",e),m.log("Compressed file",a),a.size>1e6?(0,r.d)("negative","Выберите другое изображение<br>это слишком большое"):a.size<11e3?(0,r.d)("negative","Выберите другое изображение<br>это слишком маленькое"):(I.value.userPhoto=new File([a],"image.jpg",{type:a.type}),I.value.imageUrl=URL.createObjectURL(I.value.userPhoto))}),P,R)}};function S(e,a,l){let t=e.width,u=e.height;return t>u?t>a&&(u=Math.round(u*a/t),t=a):u>l&&(t=Math.round(t*l/u),u=l),[t,u]}function z(){return I.value.middleName?I.value.firstName+" "+I.value.lastName+" "+I.value.middleName:I.value.firstName+" "+I.value.lastName}const A=async()=>{const e=await a.getKeyPair(),l=new n.EraChain.Type.PublicKeyAccount(e.publicKey),t=new Int8Array(await I.value.userPhoto.arrayBuffer()),u=await new n.EraChain.Type.PersonHuman(l,z(),new Date(I.value.birthday).getTime(),new Date(I.value.birthday).getTime(),I.value.gender,"",0,0,"","","",0,new Int8Array(0),t,""),s=await u.raw64(e.secretKey);let o=new FormData;o.set("person",JSON.stringify(I.value)),o.set("user_photo",I.value.user_photo),o.set("passport",I.value.passport),o.set("wallet",Z.value),o.set("raw",s),m.log(o);await(0,i.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/settings/new_person",data:o});(0,r.d)("positive","Запрос на верификацию отправлен<br>Ожидайте...")};return(e,a)=>{const l=(0,t.up)("page-header"),n=(0,t.up)("q-icon"),r=(0,t.up)("q-avatar"),o=(0,t.up)("q-input"),d=(0,t.up)("q-btn"),i=(0,t.up)("q-date"),m=(0,t.up)("q-popup-proxy"),W=(0,t.up)("q-radio"),x=(0,t.up)("q-file"),P=(0,t.up)("btn"),R=(0,t.up)("page-body"),Z=(0,t.up)("page"),S=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Z,null,{default:(0,t.w5)((()=>[(0,t.Wm)(R,{class:"q-px-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(l),p,(0,u.SU)(j)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",v,[(0,t.Wm)(r,{size:"150px",class:"relative-position q-mr-md"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:I.value.imageUrl?I.value.imageUrl:"/noavatar.png",alt:""},null,8,g),(0,t._)("label",b,[(0,t.Wm)(n,{size:"md",color:"white",class:"bg-primary round q-pa-sm",name:"photo_camera"}),(0,t._)("input",{id:"take_img",ref_key:"photo",ref:N,onChange:F,style:{display:"none"},type:"file"},null,544)])])),_:1}),h]),(0,t.Wm)(o,{rounded:"",modelValue:I.value.firstName,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value.firstName=e),dense:"",label:"Имя*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(o,{rounded:"",modelValue:I.value.lastName,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.lastName=e),dense:"",label:"Фамилия*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(o,{rounded:"",modelValue:I.value.middleName,"onUpdate:modelValue":a[2]||(a[2]=e=>I.value.middleName=e),dense:"",label:"Отчество",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(o,{rounded:"",label:"Дата рождения*",outlined:"",clearable:"",dense:"",modelValue:I.value.birthday,"onUpdate:modelValue":a[4]||(a[4]=e=>I.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.w5)((()=>[(0,t.Wm)(n,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:I.value.birthday,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value.birthday=e)},{default:(0,t.w5)((()=>[(0,t._)("div",y,[(0,t.wy)((0,t.Wm)(d,{label:"Выбрать",color:"primary",flat:""},null,512),[[S]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),f,(0,t._)("div",w,[(0,t.Wm)(W,{modelValue:I.value.gender,"onUpdate:modelValue":a[5]||(a[5]=e=>I.value.gender=e),val:0,label:"Мужской"},null,8,["modelValue"]),(0,t.Wm)(W,{modelValue:I.value.gender,"onUpdate:modelValue":a[6]||(a[6]=e=>I.value.gender=e),val:1,label:"Женский"},null,8,["modelValue"])]),(0,t.Wm)(x,{rounded:"",modelValue:I.value.passport,"onUpdate:modelValue":a[7]||(a[7]=e=>I.value.passport=e),dense:"",label:"Скан разворота паспорта*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(P,{label:e.$t("pay_1000"),disabled:(0,u.SU)(L),loading:(0,u.SU)(C),onClick:A,outline:!1},null,8,["label","disabled","loading"])])),(0,t.wy)((0,t._)("div",null,[_,(0,u.SU)(Q)?((0,t.wg)(),(0,t.iD)("p",U,[V,(0,t._)("a",{style:{},id:"d_link",href:(0,u.SU)(Q)},"скачайте",8,q),k])):(0,t.kq)("",!0)],512),[[s.F8,(0,u.SU)(j)]])])),_:1})])),_:1})}}};var W=l(61357),x=l(22857),P=l(13119),R=l(52765),C=l(67088),j=l(24455),Q=l(11480),I=l(33837),L=l(62146),Z=l(69984),F=l.n(Z);const S=N,z=S;F()(N,"components",{QAvatar:W.Z,QIcon:x.Z,QInput:P.Z,QPopupProxy:R.Z,QDate:C.Z,QBtn:j.Z,QRadio:Q.Z,QFile:I.Z}),F()(N,"directives",{ClosePopup:L.Z})}}]);